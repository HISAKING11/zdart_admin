<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blog Upload</title>
  <link rel="stylesheet" href="./admin.css" />
  <link rel="stylesheet" href="./admin2.css" />
</head>
<body>

<div class="menu-bar">
  <div class="menu-item" onclick="location.href='./admin.html'">Image Upload na</div>
  <div class="menu-item" onclick="location.href='./admin3.html'">Image Upload tawh te</div>
  <div class="menu-item active">Blog Upload</div>
  <div class="menu-item" onclick="location.href='./admin4.html'">Blog Upload tawh te</div>
</div>

<div class="section active">
  <h2>Blog Upload</h2>
  <form id="blogUploadForm">
    <label>Title(Thupui) <small style="color:#f87171;">*</small></label>
    <input type="text" id="blogTitle" placeholder="Enter blog title(Thupui)" required />
    
    <label>Description(thu leh hla) <small style="color:#f87171;">*</small></label>
    <textarea id="blogDescription" rows="6" placeholder="Enter blog description(thu leh hla)" required></textarea>
    
    <label>Image Upload na<small style="color:#f87171;">*</small></label>
    <input type="file" id="blogImage" accept="image/*" required />
    
    <button type="submit">Submit Blog</button>
  </form>
  <div id="uploadResult"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
  getFirestore, collection, addDoc, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAD0j20UUYETyC4FflYoW5gXZlgEdHiidQ",
  authDomain: "zdart-70ce1.firebaseapp.com",
  projectId: "zdart-70ce1",
  storageBucket: "zdart-70ce1.appspot.com",
  messagingSenderId: "969125577134",
  appId: "1:969125577134:web:f8bc6c82c5f6a3f9ee483f",
  measurementId: "G-W0KZRR52T2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const CLOUD_NAME = "dqakyi3qt";
const UPLOAD_PRESET = "zdarts";

async function uploadImage(file) {
  const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`;
  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", UPLOAD_PRESET);
  const res = await fetch(url, { method: "POST", body: formData });
  const data = await res.json();
  if (!data.secure_url) throw new Error("Upload failed");
  return data.secure_url;
}

document.getElementById('blogUploadForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const title = document.getElementById('blogTitle').value.trim();
  const description = document.getElementById('blogDescription').value.trim();
  const file = document.getElementById('blogImage').files[0];
  const resultDiv = document.getElementById('uploadResult');

  if (!title || !description || !file) {
    alert('Thlalak leh a thu dah zawh angai !');
    return;
  }

  resultDiv.innerHTML = '<p style="text-align:center;color:var(--accent);">⏳ Uploading blog...</p>';

  try {
    const imageUrl = await uploadImage(file);
    await addDoc(collection(db, "blog"), {
      title, description, imageUrl, createdAt: serverTimestamp()
    });

    resultDiv.innerHTML = '<div class="success-message">✅ Blog upload ani e!</div>';
    e.target.reset();
    setTimeout(() => { resultDiv.innerHTML = ''; }, 3000);

  } catch (err) {
    console.error("Error:", err);
    resultDiv.innerHTML = '<p style="text-align:center;color:#ef4444;">❌ Blog update na ah buaina awm tlat.</p>';
  }
});
</script>

</body>
</html>
